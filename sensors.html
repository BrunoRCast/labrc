<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug de Sensores Smartphone</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        h1 { text-align: center; font-size: 1.5rem; }
        h2 { font-size: 1.1rem; color: #4db8ff; border-bottom: 1px solid #444; margin-top: 30px; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        th { background-color: #333; color: #aaa; font-weight: normal; width: 40%; }
        td { font-family: monospace; font-size: 1.1rem; color: #81c784; }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .btn:active { background-color: #0056b3; }
        .note { font-size: 0.8rem; color: #888; text-align: center; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <h1>üîç Debugger de Sensores</h1>
    <p class="note">Necess√°rio HTTPS. No iOS, clique no bot√£o abaixo.</p>
    
    <button id="btn-permission" class="btn" onclick="requestPermissions()">Ativar Sensores (Obrigat√≥rio iOS 13+)</button>

    <!-- Aceler√¥metro -->
    <h2>Aceler√¥metro (Movimento)</h2>
    <table>
        <tr><th>Eixo X</th><td id="acc-x">0.00</td></tr>
        <tr><th>Eixo Y</th><td id="acc-y">0.00</td></tr>
        <tr><th>Eixo Z</th><td id="acc-z">0.00</td></tr>
    </table>

    <!-- Girosc√≥pio -->
    <h2>Girosc√≥pio (Orienta√ß√£o)</h2>
    <table>
        <tr><th>Alpha (Z)</th><td id="gyr-alpha">0.00</td></tr>
        <tr><th>Beta (X)</th><td id="gyr-beta">0.00</td></tr>
        <tr><th>Gamma (Y)</th><td id="gyr-gamma">0.00</td></tr>
    </table>

    <!-- GPS -->
    <h2>Geolocaliza√ß√£o (GPS)</h2>
    <table>
        <tr><th>Latitude</th><td id="geo-lat">Aguardando...</td></tr>
        <tr><th>Longitude</th><td id="geo-lon">Aguardando...</td></tr>
        <tr><th>Precis√£o</th><td id="geo-acc">Aguardando...</td></tr>
        <tr><th>Velocidade</th><td id="geo-spd">0 m/s</td></tr>
    </table>

    <!-- Sistema -->
    <h2>Sistema & Ambiente</h2>
    <table>
        <tr><th>N√≠vel Bateria</th><td id="bat-level">...</td></tr>
        <tr><th>Status Bateria</th><td id="bat-status">...</td></tr>
        <tr><th>Tipo de Rede</th><td id="net-type">...</td></tr>
        <tr><th>Velocidade Est.</th><td id="net-speed">...</td></tr>
    </table>

    <script>
        // Fun√ß√£o para atualizar o DOM
        function updateValue(id, value) {
            const el = document.getElementById(id);
            if(el) el.innerText = value;
        }

        // 1. Aceler√¥metro e Girosc√≥pio
        function handleMotion(event) {
            updateValue('acc-x', (event.accelerationIncludingGravity.x || 0).toFixed(2));
            updateValue('acc-y', (event.accelerationIncludingGravity.y || 0).toFixed(2));
            updateValue('acc-z', (event.accelerationIncludingGravity.z || 0).toFixed(2));
        }

        function handleOrientation(event) {
            updateValue('gyr-alpha', (event.alpha || 0).toFixed(2));
            updateValue('gyr-beta', (event.beta || 0).toFixed(2));
            updateValue('gyr-gamma', (event.gamma || 0).toFixed(2));
        }

        // Solicita√ß√£o de permiss√£o (Crucial para iOS 13+)
        function requestPermissions() {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('devicemotion', handleMotion);
                            window.addEventListener('deviceorientation', handleOrientation);
                            document.getElementById('btn-permission').classList.add('hidden');
                        } else {
                            alert("Permiss√£o negada para sensores.");
                        }
                    })
                    .catch(console.error);
            } else {
                // Android e vers√µes antigas n√£o precisam de requestPermission expl√≠cito via bot√£o
                alert("Tentando ativar sensores (padr√£o Android)...");
                window.addEventListener('devicemotion', handleMotion);
                window.addEventListener('deviceorientation', handleOrientation);
                document.getElementById('btn-permission').classList.add('hidden');
            }
        }

        // Inicializa√ß√£o autom√°tica para Android/PC (tenta iniciar, se falhar o bot√£o resolve)
        if (typeof DeviceMotionEvent.requestPermission !== 'function') {
            window.addEventListener('devicemotion', handleMotion);
            window.addEventListener('deviceorientation', handleOrientation);
            document.getElementById('btn-permission').classList.add('hidden');
        }

        // 2. Geolocaliza√ß√£o
        if ("geolocation" in navigator) {
            navigator.geolocation.watchPosition((position) => {
                updateValue('geo-lat', position.coords.latitude.toFixed(5));
                updateValue('geo-lon', position.coords.longitude.toFixed(5));
                updateValue('geo-acc', `+/- ${position.coords.accuracy.toFixed(0)}m`);
                updateValue('geo-spd', position.coords.speed ? position.coords.speed.toFixed(1) + ' m/s' : '0 m/s');
            }, (error) => {
                updateValue('geo-lat', 'Erro/Negado');
            }, {
                enableHighAccuracy: true
            });
        }

        // 3. Bateria
        if ('getBattery' in navigator) {
            navigator.getBattery().then(function(battery) {
                function updateBattery() {
                    updateValue('bat-level', (battery.level * 100).toFixed(0) + '%');
                    updateValue('bat-status', battery.charging ? 'Carregando ‚ö°' : 'Descarregando');
                }
                updateBattery();
                battery.addEventListener('levelchange', updateBattery);
                battery.addEventListener('chargingchange', updateBattery);
            });
        } else {
            updateValue('bat-level', 'N√£o suportado');
        }

        // 4. Rede
        if ('connection' in navigator) {
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            function updateConnection() {
                updateValue('net-type', connection.effectiveType || 'N/A');
                updateValue('net-speed', connection.downlink ? connection.downlink + ' Mbps' : 'N/A');
            }
            updateConnection();
            connection.addEventListener('change', updateConnection);
        } else {
            updateValue('net-type', 'N√£o suportado');
        }

    </script>
</body>
</html>
